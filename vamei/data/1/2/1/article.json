{"content":"<p><span style=\"font-family: courier new,courier;\"><span style=\"color: #ff0000;\"><span style=\"color: #000000;\">&#x4F5C;&#x8005;&#xFF1A;Vamei &#x51FA;&#x5904;&#xFF1A;http://www.cnblogs.com/vamei &#x6B22;&#x8FCE;&#x8F6C;&#x8F7D;&#xFF0C;&#x4E5F;&#x8BF7;&#x4FDD;&#x7559;&#x8FD9;&#x6BB5;&#x58F0;&#x660E;&#x3002;&#x8C22;&#x8C22;&#xFF01;</span><br></span></span></p>\r\n<p><span style=\"font-family: courier new,courier;\"><span style=\"color: #ff0000;\"><span style=\"color: #000000;\">&#xA0;</span></span></span></p>\r\n<p><span style=\"font-family: courier new,courier;\"><span style=\"color: #ff0000;\">&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;</span>(context manager)&#x662F;Python2.5&#x5F00;&#x59CB;&#x652F;&#x6301;&#x7684;&#x4E00;&#x79CD;&#x8BED;&#x6CD5;&#xFF0C;&#x7528;&#x4E8E;&#x89C4;&#x5B9A;<span style=\"color: #ff0000;\">&#x67D0;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x4F7F;&#x7528;&#x8303;&#x56F4;</span>&#x3002;&#x4E00;&#x65E6;&#x8FDB;&#x5165;&#x6216;&#x8005;&#x79BB;&#x5F00;&#x8BE5;&#x4F7F;&#x7528;&#x8303;&#x56F4;&#xFF0C;&#x4F1A;&#x6709;&#x7279;&#x6B8A;&#x64CD;&#x4F5C;&#x88AB;&#x8C03;&#x7528; (&#x6BD4;&#x5982;&#x4E3A;&#x5BF9;&#x8C61;&#x5206;&#x914D;&#x6216;&#x8005;&#x91CA;&#x653E;&#x5185;&#x5B58;)&#x3002;&#x5B83;&#x7684;&#x8BED;&#x6CD5;&#x5F62;&#x5F0F;&#x662F;<span style=\"color: #993300;\">with...as...</span></span></p>\r\n<p>&#xA0;</p>\r\n<h3><span style=\"font-family: courier new,courier;\">&#x5173;&#x95ED;&#x6587;&#x4EF6;</span></h3>\r\n<p><span style=\"font-family: courier new,courier;\">&#x6211;&#x4EEC;&#x4F1A;&#x8FDB;&#x884C;&#x8FD9;&#x6837;&#x7684;&#x64CD;&#x4F5C;&#xFF1A;&#x6253;&#x5F00;&#x6587;&#x4EF6;&#xFF0C;&#x8BFB;&#x5199;&#xFF0C;&#x5173;&#x95ED;&#x6587;&#x4EF6;&#x3002;&#x7A0B;&#x5E8F;&#x5458;&#x7ECF;&#x5E38;&#x4F1A;&#x5FD8;&#x8BB0;&#x5173;&#x95ED;&#x6587;&#x4EF6;&#x3002;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x53EF;&#x4EE5;&#x5728;&#x4E0D;&#x9700;&#x8981;&#x6587;&#x4EF6;&#x7684;&#x65F6;&#x5019;&#xFF0C;<span style=\"color: #ff0000;\">&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x6587;&#x4EF6;</span>&#x3002;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x4E24;&#x6BB5;&#x7A0B;&#x5E8F;&#xFF1A;</span></p>\r\n<div class=\"cnblogs_code\">\r\n<pre><span style=\"color: #008000; font-family: courier new,courier;\"># without context manager</span><br><span style=\"font-family: courier new,courier;\">f = open(<span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">new.txt</span><span style=\"color: #800000;\">&quot;</span>, <span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">w</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #000000;\">)\r\n<span style=\"color: #0000ff;\">print</span>(f.closed) &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0; &#xA0;<span style=\"color: #008000;\"> # whether the file is open</span><br>f.write(</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">Hello World!</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #000000;\">)\r\nf.close()<br></span><span style=\"color: #0000ff;\">print</span>(f.closed)</span></pre>\r\n</div>\r\n<p><span style=\"font-family: courier new,courier;\">&#x4EE5;&#x53CA;&#xFF1A;</span></p>\r\n<div class=\"cnblogs_code\">\r\n<pre><span style=\"color: #008000; font-family: courier new,courier;\"># with context manager</span><br><span style=\"font-family: courier new,courier;\">with open(<span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">new.txt</span><span style=\"color: #800000;\">&quot;</span>, <span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">w</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #000000;\">) as f:<br>    <span style=\"color: #0000ff;\">print</span>(f.closed)\r\n    f.write(</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">Hello World!</span><span style=\"color: #800000;\">&quot;</span>)</span><br><span style=\"font-family: courier new,courier;\"><span style=\"color: #0000ff;\">print</span>(f.closed)</span></pre>\r\n</div>\r\n<p><span style=\"font-family: courier new,courier;\">&#x4E24;&#x6BB5;&#x7A0B;&#x5E8F;&#x5B9E;&#x9645;&#x4E0A;&#x6267;&#x884C;&#x7684;&#x662F;&#x76F8;&#x540C;&#x7684;&#x64CD;&#x4F5C;&#x3002;&#x6211;&#x4EEC;&#x7684;&#x7B2C;&#x4E8C;&#x6BB5;&#x7A0B;&#x5E8F;&#x5C31;&#x4F7F;&#x7528;&#x4E86;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668; (<span style=\"color: #993300;\">with...as...</span>)&#x3002;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x6709;<span style=\"color: #ff0000;\">&#x96B6;&#x5C5E;&#x4E8E;&#x5B83;&#x7684;&#x7A0B;&#x5E8F;&#x5757;</span>&#x3002;&#x5F53;&#x96B6;&#x5C5E;&#x7684;&#x7A0B;&#x5E8F;&#x5757;&#x6267;&#x884C;&#x7ED3;&#x675F;&#x7684;&#x65F6;&#x5019;(&#x4E5F;&#x5C31;&#x662F;&#x4E0D;&#x518D;&#x7F29;&#x8FDB;)&#xFF0C;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x81EA;&#x52A8;&#x5173;&#x95ED;&#x4E86;&#x6587;&#x4EF6; (&#x6211;&#x4EEC;&#x901A;&#x8FC7;<span style=\"color: #993300;\">f.closed</span>&#x6765;&#x67E5;&#x8BE2;&#x6587;&#x4EF6;&#x662F;&#x5426;&#x5173;&#x95ED;)&#x3002;&#x6211;&#x4EEC;&#x76F8;&#x5F53;&#x4E8E;&#x4F7F;&#x7528;<span style=\"color: #ff0000;\">&#x7F29;&#x8FDB;</span>&#x89C4;&#x5B9A;&#x4E86;&#x6587;&#x4EF6;&#x5BF9;&#x8C61;f&#x7684;<span style=\"color: #ff0000;\">&#x4F7F;&#x7528;&#x8303;&#x56F4;</span>&#x3002;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">&#xA0;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">&#x4E0A;&#x9762;&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x57FA;&#x4E8E;f&#x5BF9;&#x8C61;&#x7684;<span style=\"color: #993300;\">__exit__()</span>&#x7279;&#x6B8A;&#x65B9;&#x6CD5;(&#x8FD8;&#x8BB0;&#x5F97;&#x6211;&#x4EEC;&#x5982;&#x4F55;&#x5229;&#x7528;&#x7279;&#x6B8A;&#x65B9;&#x6CD5;&#x6765;&#x5B9E;&#x73B0;&#x5404;&#x79CD;&#x8BED;&#x6CD5;&#xFF1F;&#x53C2;&#x770B;<a href=\"http://www.cnblogs.com/vamei/archive/2012/11/19/2772441.html\">&#x7279;&#x6B8A;&#x65B9;&#x6CD5;&#x4E0E;&#x591A;&#x8303;&#x5F0F;</a>)&#x3002;&#x5F53;&#x6211;&#x4EEC;&#x4F7F;&#x7528;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x8BED;&#x6CD5;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5B9E;&#x9645;&#x4E0A;&#x8981;&#x6C42;Python&#x5728;&#x8FDB;&#x5165;&#x7A0B;&#x5E8F;&#x5757;&#x4E4B;&#x524D;&#x8C03;&#x7528;&#x5BF9;&#x8C61;&#x7684;<span style=\"color: #993300;\">__enter__()</span>&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x7ED3;&#x675F;&#x7A0B;&#x5E8F;&#x5757;&#x7684;&#x65F6;&#x5019;&#x8C03;&#x7528;<span style=\"color: #993300;\">__exit__()</span>&#x65B9;&#x6CD5;&#x3002;&#x5BF9;&#x4E8E;&#x6587;&#x4EF6;&#x5BF9;&#x8C61;f&#x6765;&#x8BF4;&#xFF0C;&#x5B83;&#x5B9A;&#x4E49;&#x4E86;__enter__()&#x548C;__exit__()&#x65B9;&#x6CD5;(&#x53EF;&#x4EE5;&#x901A;&#x8FC7;<span style=\"color: #993300;\">dir(f)</span>&#x770B;&#x5230;)&#x3002;&#x5728;f&#x7684;__exit__()&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x6709;<span style=\"color: #993300;\">self.close()<span style=\"color: #000000;\">&#x8BED;&#x53E5;</span></span>&#x3002;&#x6240;&#x4EE5;&#x5728;&#x4F7F;&#x7528;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x65F6;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x4E0D;&#x7528;&#x660E;&#x6587;&#x5173;&#x95ED;f&#x6587;&#x4EF6;&#x4E86;&#x3002;</span></p>\r\n<p>&#xA0;</p>\r\n<h3><span style=\"font-family: courier new,courier;\">&#x81EA;&#x5B9A;&#x4E49;</span></h3>\r\n<p><span style=\"font-family: courier new,courier;\"><span style=\"color: #ff0000;\">&#x4EFB;&#x4F55;</span>&#x5B9A;&#x4E49;&#x4E86;__enter__()&#x548C;__exit__()&#x65B9;&#x6CD5;&#x7684;&#x5BF9;&#x8C61;&#x90FD;&#x53EF;&#x4EE5;&#x7528;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x3002;&#x6587;&#x4EF6;&#x5BF9;&#x8C61;f&#x662F;&#x5185;&#x7F6E;&#x5BF9;&#x8C61;&#xFF0C;&#x6240;&#x4EE5;f&#x81EA;&#x52A8;&#x5E26;&#x6709;&#x8FD9;&#x4E24;&#x4E2A;&#x7279;&#x6B8A;&#x65B9;&#x6CD5;&#xFF0C;&#x4E0D;&#x9700;&#x8981;&#x81EA;&#x5B9A;&#x4E49;&#x3002;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">&#x4E0B;&#x9762;&#xFF0C;&#x6211;&#x4EEC;&#x81EA;&#x5B9A;&#x4E49;&#x7528;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5C31;&#x662F;&#x4E0B;&#x9762;&#x7684;myvow&#xFF1A;</span></p>\r\n<p>&#xA0;</p>\r\n<div class=\"cnblogs_code\">\r\n<pre><span style=\"font-family: courier new,courier;\"><span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> customized object</span>\r\n\r\n<span style=\"color: #0000ff;\">class</span><span style=\"color: #000000;\"> VOW(object):\r\n    </span><span style=\"color: #0000ff;\">def</span> <span style=\"color: #800080;\">__init__</span><span style=\"color: #000000;\">(self, text):\r\n        self.text </span>=<span style=\"color: #000000;\"> text\r\n    </span><span style=\"color: #0000ff;\">def</span> <span style=\"color: #800080;\">__enter__</span><span style=\"color: #000000;\">(self):\r\n        self.text </span>= <span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">I say: </span><span style=\"color: #800000;\">&quot;</span> + self.text    <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> add prefix</span>\r\n        <span style=\"color: #0000ff;\">return</span> self                          <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> note: return an object</span>\r\n    <span style=\"color: #0000ff;\">def</span> <span style=\"color: #800080;\">__exit__</span><span style=\"color: #000000;\">(self,exc_type,exc_value,traceback):\r\n        self.text </span>= self.text + <span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">!</span><span style=\"color: #800000;\">&quot;</span>          <span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> add suffix</span>\r\n<span style=\"color: #000000;\">\r\n\r\nwith VOW(</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #800000;\">I&apos;m fine</span><span style=\"color: #800000;\">&quot;</span><span style=\"color: #000000;\">) as myvow:\r\n    </span><span style=\"color: #0000ff;\">print</span><span style=\"color: #000000;\">(myvow.text)\r\n\r\n</span><span style=\"color: #0000ff;\">print</span>(myvow.text)</span></pre>\r\n</div>\r\n<p>&#xA0;</p>\r\n<p><span style=\"font-family: courier new,courier;\">&#x6211;&#x4EEC;&#x7684;&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#x5982;&#x4E0B;:</span></p>\r\n<div class=\"cnblogs_code\">\r\n<pre><span style=\"color: #000000; font-family: courier new,courier;\">I say: I&apos;m fine\r\nI say: I&apos;m fine!</span></pre>\r\n</div>\r\n<p><span style=\"font-family: courier new,courier;\">&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5728;&#x8FDB;&#x5165;&#x4E0A;&#x4E0B;&#x6587;&#x548C;&#x79BB;&#x5F00;&#x4E0A;&#x4E0B;&#x6587;&#x65F6;&#xFF0C;&#x5BF9;&#x8C61;&#x7684;text&#x5C5E;&#x6027;&#x53D1;&#x751F;&#x4E86;&#x6539;&#x53D8;(&#x6700;&#x521D;&#x7684;text&#x5C5E;&#x6027;&#x662F;&quot;I&apos;m fine&quot;)&#x3002;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">__enter__()&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x3002;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x4F1A;&#x4F7F;&#x7528;&#x8FD9;&#x4E00;&#x5BF9;&#x8C61;&#x4F5C;&#x4E3A;<span style=\"color: #993300;\">as</span>&#x6240;&#x6307;&#x7684;&#x53D8;&#x91CF;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;myvow&#x3002;&#x5728;__enter__()&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;myvow.text&#x589E;&#x52A0;&#x4E86;&#x524D;&#x7F00; (&quot;I say: &quot;)&#x3002;&#x5728;__exit__()&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x4E3A;myvow.text&#x589E;&#x52A0;&#x4E86;&#x540E;&#x7F00;(&quot;!&quot;)&#x3002;</span></p>\r\n<p><span style=\"font-family: courier new,courier;\">&#x6CE8;&#x610F;: __exit__()&#x4E2D;&#x6709;&#x56DB;&#x4E2A;&#x53C2;&#x6570;&#x3002;&#x5F53;&#x7A0B;&#x5E8F;&#x5757;&#x4E2D;&#x51FA;&#x73B0;<span style=\"color: #ff0000;\">&#x5F02;&#x5E38;</span>(exception)&#xFF0C;<span style=\"color: #993300;\">__exit__()<span style=\"color: #000000;\">&#x7684;&#x53C2;&#x6570;</span></span>&#x4E2D;<span style=\"color: #993300;\">exc_type</span>,<span style=\"color: #993300;\"> exc_value</span>, <span style=\"color: #993300;\">traceback</span>&#x7528;&#x4E8E;&#x63CF;&#x8FF0;&#x5F02;&#x5E38;&#x3002;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x5904;&#x7406;&#x3002;&#x5982;&#x679C;&#x6B63;&#x5E38;&#x8FD0;&#x884C;&#x7ED3;&#x675F;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x53C2;&#x6570;&#x90FD;&#x662F;<span style=\"color: #993300;\">None</span>&#x3002;&#x5728;&#x6211;&#x4EEC;&#x7684;&#x7A0B;&#x5E8F;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x5E76;&#x6CA1;&#x6709;&#x7528;&#x5230;&#x8FD9;&#x4E00;&#x7279;&#x6027;&#x3002;</span></p>\r\n<p>&#xA0;</p>\r\n<h3>&#x603B;&#x7ED3;&#xFF1A;</h3>\r\n<p>&#x901A;&#x8FC7;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x6211;&#x4EEC;&#x63A7;&#x5236;&#x5BF9;&#x8C61;&#x5728;&#x7A0B;&#x5E8F;&#x4E0D;&#x540C;&#x533A;&#x95F4;&#x7684;&#x7279;&#x6027;&#x3002;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;(<span style=\"color: #993300;\">with EXPR as VAR</span>)&#x5927;&#x81F4;&#x76F8;&#x5F53;&#x4E8E;&#x5982;&#x4E0B;&#x6D41;&#x7A0B;:</p>\r\n<div class=\"cnblogs_code\">\r\n<pre><span style=\"color: #008000;\">#</span><span style=\"color: #008000;\"> with EXPR as VAR:</span>\r\n<span style=\"color: #000000;\">\r\nVAR </span>=<span style=\"color: #000000;\"> EXPR\r\nVAR </span>= VAR.<span style=\"color: #800080;\">__enter__</span><span style=\"color: #000000;\">()\r\n</span><span style=\"color: #0000ff;\">try</span><span style=\"color: #000000;\">:\r\n    BLOCK\r\n</span><span style=\"color: #0000ff;\">finally</span><span style=\"color: #000000;\">:\r\n    VAR.</span><span style=\"color: #800080;\">__exit__</span>()</pre>\r\n</div>\r\n<p>&#x7531;&#x4E8E;&#x4E0A;&#x4E0B;&#x6587;&#x7BA1;&#x7406;&#x5668;&#x5E26;&#x6765;&#x7684;&#x4FBF;&#x5229;&#xFF0C;&#x5B83;&#x662F;&#x4E00;&#x4E2A;&#x503C;&#x5F97;&#x4F7F;&#x7528;&#x7684;&#x5DE5;&#x5177;&#x3002;</p>\r\n<p><span style=\"font-family: courier new,courier;\">&#xA0;</span></p>"}